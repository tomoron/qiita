<!--
title:   【Rails】マイグレーションのロールバックを確認すべし
tags:    Rails,Ruby,migrate
id:      3ff30afcdcbef0f57685
private: false
-->

# 初めに

マイグレーションファイルを追加した後、ロールバックできるか確認していますか。

## 環境

- Rails 6.1.4
- Ruby 2.7.4

# マイグレーションのロールバック

開発を進める中でデータベースのバージョンを上げることがありますが、正しく動作しないマイグレーションがチームで共有されると、エラーが解消するまで開発が止まってしまいます。

マイグレーションを追加するときは、バージョンを上げるだけでなく、下げることができるようにするのが通常であると考えたほうがいい。

## ロールバックできるかを確認する

エラーを防ぐために、バージョンを上げた後にロールバックし、もう一度バージョンを上げて確認をします。

1. まずは`rails db:migrate`でバージョンを上げてエラーが起きるかを確認する。

2. その次に、`rails db:migrate:redo`を行い、バージョンを下げて後にもう一度上げてエラーが起きないか確認する。

`rails db:migrate:redo`はマイグレーションのバージョンを下げた後に上げて元に戻します。

# 参考

[Active Record マイグレーション - Rails ガイド](https://railsguides.jp/active_record_migrations.html)
